import "@testing-library/jest-dom";
import { extFileMock } from "../src/mocks/extFileMock";
import { ExtFile } from "../src/types";
import { uploadExtFile } from "../src/upload"
import { NO_URL_MESSAGE, NO_XHR_MESSAGE } from "../src/utils/constants";

it("Check response when xhr is not provided undefined", async () => {
    const extFileMockObject: ExtFile = extFileMock(28);
    extFileMockObject.xhr = undefined;
    const extFileMockObjectResult: ExtFile = await uploadExtFile(
        extFileMockObject,
        ""
    );

    const { uploadMessage, uploadStatus, serverResponse } = extFileMockObjectResult;


    expect(uploadMessage).toEqual(NO_XHR_MESSAGE);
    expect(uploadStatus).toEqual("error");
    expect(serverResponse?.success).toBeFalsy();
});

it("Check response when url is undefined", async () => {
    const extFileMockObject: ExtFile = extFileMock(28);
    extFileMockObject.uploadUrl=undefined;
    const extFileMockObjectResult: ExtFile = await uploadExtFile(
        extFileMockObject,
        undefined
    );

    const { uploadMessage, uploadStatus, serverResponse } = extFileMockObjectResult;


    expect(uploadMessage).toEqual(NO_URL_MESSAGE);
    expect(uploadStatus).toEqual("error");
    expect(serverResponse?.success).toBeFalsy();
});

it("Check response when url is empty string", async () => {
    const extFileMockObject: ExtFile = extFileMock(28);
    extFileMockObject.uploadUrl=undefined;
    const extFileMockObjectResult: ExtFile = await uploadExtFile(
        extFileMockObject,
        ""
    );

    const { uploadMessage, uploadStatus, serverResponse } = extFileMockObjectResult;


    expect(uploadMessage).toEqual(NO_URL_MESSAGE);
    expect(uploadStatus).toEqual("error");
    expect(serverResponse?.success).toBeFalsy();
});

it("Check response when ExtFle.uploadUrl is empty", async () => {
    const extFileMockObject: ExtFile = extFileMock(28);
    extFileMockObject.uploadUrl = "";
    const extFileMockObjectResult: ExtFile = await uploadExtFile(
        extFileMockObject,
        ""
    );

    const { uploadMessage, uploadStatus, serverResponse } = extFileMockObjectResult;


    expect(uploadMessage).toEqual(NO_URL_MESSAGE);
    expect(uploadStatus).toEqual("error");
    expect(serverResponse?.success).toBeFalsy();
});